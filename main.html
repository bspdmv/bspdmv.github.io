<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sign In</title>
    <link rel="icon" type="image/x-icon" href="icon.png">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@100..900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet-draw/dist/leaflet.draw.css" />
    <style>
        body {
            margin: 0;
            font-family: 'Roboto', sans-serif;
        }

        #header {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            background-color: white;
            color: black;
            padding: 15px 20px;
            text-align: center;
            font-size: 24px;
            font-weight: bold;
            z-index: 2000;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        #map {
            height: calc(100vh - 80px);
            width: 100%;
            margin-top: 80px;
        }

        #menu {
            position: absolute;
            top: 100px;
            right: 20px;
            background: white;
            padding: 15px;
            border: 1px solid #ccc;
            z-index: 1000;
            width: 270px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        #menu label, #menu input, #menu select, #menu textarea, #menu button {
            display: block;
            margin-bottom: 10px;
            width: 100%;
        }

        #menu input[type="color"] {
            padding: 5px;
        }

        #logo-preview {
            width: 100px;
            height: 100px;
            margin: 10px 0;
            border: 1px solid #ccc;
            object-fit: contain;
            display: none;
        }

        #clear-btn {
            background-color: #ff4d4d;
            color: white;
            border: none;
            padding: 12px;
            cursor: pointer;
            font-size: 16px;
            margin-top: 15px;
            border-radius: 5px;
        }

        #clear-btn:hover {
            background-color: #ff1a1a;
        }

        #clear-info {
            font-size: 12px;
            color: #777;
            text-align: center;
        }
    </style>
</head>
<body>
    <div id="header">Bacationary Street Panel</div>
    <div id="map"></div>
    <div id="menu">
        <label for="name">Territory Name:</label>
        <input type="text" id="name" placeholder="Enter territory name">

        <label for="description">Territory Description:</label>
        <textarea id="description" rows="3" placeholder="Enter a brief description"></textarea>

        <label for="color">Change Parcel Color:</label>
        <input type="color" id="color" value="#800080">

        <label for="logo">Upload Logo:</label>
        <input type="file" id="logo">
        <img id="logo-preview" alt="Logo Preview">

        <label for="territory-type">Territory Type:</label>
        <select id="territory-type">
            <option value="neutral">Neutral</option>
            <option value="rival">Rival</option>
            <option value="allied">Allied</option>
        </select>

        <button id="apply">Apply Changes</button>
        <button id="clear-btn">Clear Everything</button>
        <div id="clear-info">Refresh the page after clearing parcels to reset storage.</div>
    </div>

    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet-draw/dist/leaflet.draw.js"></script>
    <script>
        const map = L.map('map').setView([38.80158522652945, -77.30930326163133], 15);
        const baseLayer = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { maxZoom: 19 }).addTo(map);
        const drawnItems = new L.FeatureGroup().addTo(map);

        const drawControl = new L.Control.Draw({
            edit: { featureGroup: drawnItems },
            draw: {
                polygon: true,
                rectangle: false,
                circle: false,
                polyline: false,
                marker: false
            }
        }).addTo(map);

        let selectedLayer = null;
        const savedData = JSON.parse(localStorage.getItem('parcelData')) || [];

        savedData.forEach(item => {
            const layer = L.polygon(item.latlngs, { color: item.color }).addTo(drawnItems);
            layer.data = item;

            if (item.logo) {
                const center = layer.getBounds().getCenter();
                layer.logoMarker = L.marker(center, {
                    icon: L.divIcon({
                        className: 'custom-logo-icon',
                        html: `<img src="${item.logo}" style="width:50px;height:50px;">`,
                        iconSize: [50, 50],
                        iconAnchor: [25, 25]
                    })
                }).addTo(map);
            }
        });

        map.on(L.Draw.Event.CREATED, event => {
            const layer = event.layer;
            drawnItems.addLayer(layer);

            layer.data = {
                latlngs: layer.getLatLngs(),
                color: '#800080',
                logo: null,
                type: 'neutral',
                name: '',
                description: ''
            };

            selectedLayer = layer;
            openMenu();
            saveData();
        });

        drawnItems.on('click', event => {
            selectedLayer = event.layer;
            openMenu();
        });

        document.getElementById('apply').onclick = () => selectedLayer && applyChanges();
        document.getElementById('clear-btn').onclick = () => clearAllData();

        function openMenu() {
            const { color, logo, type, name, description } = selectedLayer.data;
            document.getElementById('color').value = color;
            document.getElementById('name').value = name || '';
            document.getElementById('description').value = description || '';
            const logoPreview = document.getElementById('logo-preview');
            if (logo) {
                logoPreview.src = logo;
                logoPreview.style.display = 'block';
            } else {
                logoPreview.style.display = 'none';
            }
            document.getElementById('territory-type').value = type;
        }

        function applyChanges() {
            const nameInput = document.getElementById('name').value;
            const descriptionInput = document.getElementById('description').value;
            const colorInput = document.getElementById('color').value;
            const territoryType = document.getElementById('territory-type').value;

            selectedLayer.setStyle({ color: colorInput });
            selectedLayer.data.name = nameInput;
            selectedLayer.data.description = descriptionInput;
            selectedLayer.data.color = colorInput;
            selectedLayer.data.type = territoryType;

            const logoInput = document.getElementById('logo');
            if (logoInput.files.length > 0) {
                const reader = new FileReader();
                reader.onload = event => {
                    const logoURL = event.target.result;
                    selectedLayer.data.logo = logoURL;
                    const center = selectedLayer.getBounds().getCenter();
                    if (selectedLayer.logoMarker) {
                        map.removeLayer(selectedLayer.logoMarker);
                    }
                    selectedLayer.logoMarker = L.marker(center, {
                        icon: L.divIcon({
                            className: 'custom-logo-icon',
                            html: `<img src="${logoURL}" style="width:50px;height:50px;">`,
                            iconSize: [50, 50],
                            iconAnchor: [25, 25]
                        })
                    }).addTo(map);
                    document.getElementById('logo-preview').src = logoURL;
                    document.getElementById('logo-preview').style.display = 'block';
                };
                reader.readAsDataURL(logoInput.files[0]);
            }

            saveData();
        }

        function saveData() {
            const data = [];
            drawnItems.eachLayer(layer => {
                if (layer.data) {
                    data.push(layer.data);
                }
            });
            localStorage.setItem('parcelData', JSON.stringify(data));
        }

        function clearAllData() {
            drawnItems.clearLayers();
            localStorage.removeItem('parcelData');
            document.getElementById('logo-preview').style.display = 'none';
        }
    </script>
</body>
</html>
